# 4. Kernfunktionen

Dieses Kapitel fasst die wichtigsten Bausteine zusammen, die in v1.0 produktionsreif vorliegen. Jede Funktion ist √ºber API, Frontend und zum Teil CLI nutzbar.

---

## 4.1 üîé Suche & Discovery

**Service:** `search-api` (FastAPI, OpenSearch-Backend)

### Highlights
- Volltext- und Felder-Suche (`/search`), Filter (Typ, Quelle, Zeitraum, Score) und Sortierung (Relevanz, Aktualit√§t).
- Optionales **Reranking** mittels Sentence-Transformers (aktivierbar via `RERANK_ENABLED=1`).
- Query-Analyse (Suchdauer, Trefferanzahl) direkt im UI und als JSON.
- Map-Panel f√ºr Geo-Treffer (setzt Geo-Felder oder GeoJSON-Import voraus).
- Export-Kit (JSON) mit Query-Parametern, Treffern, Facet-Counts.

### API-Beispiele
```bash
curl "http://localhost:8401/search?q=acme&limit=25&rerank=1"
curl -X POST http://localhost:8401/v1/index --data '{"id":"doc-1","title":"..."}'
```

### CLI
```bash
it search.query "ACME" --limit 10 --format json
it search.suggest "ac" --limit 5
```

---

## 4.2 üìÑ Doc-Entities & Textanalyse

**Service:** `doc-entities` (FastAPI, Postgres)

### Funktionen
- **Named Entity Recognition** (`/v1/extract/entities`) f√ºr Personen, Organisationen, Orte ‚Äì sprachkonfigurierbar.
- **Relation Extraction** (`/v1/extract/relations`) mit optionaler automatischer Entit√§tserkennung.
- **Summaries** (`/v1/summarize`) mit Kennwerten (L√§ngen, Kompressionsgrad, Laufzeit).
- **Document Annotation Pipeline** (`/v1/documents/annotate`) inkl. persistenter Speicherung, Relation-Graph-Schreibzugriff und HTML-Markierung.
- **Entity Resolution** mit Hintergrund-Jobs (Graph-Abgleich, Fuzzy-Matching).
- Fuzzy Matching & Dedupe (`/v1/fuzzy/*`) f√ºr Abgleich von Listen.

### UI
- `/nlp`: Upload/Editor, Preview, JSON-Tabs, Relationstabellen.
- Zustands-Widget: Graph-Schreibstatus, Anzahl erkannter Entit√§ten/Relationen, Summary-Metadaten.

### CLI & Automatisierung
```bash
curl -X POST http://localhost:8406/v1/documents/annotate \
  -H 'Content-Type: application/json' \
  -d '{"title":"Memo","text":"...","extract_entities":true}'
```
NiFi-Pipelines k√∂nnen Doc-Entities via REST antriggern (siehe Kapitel 14).

---

## 4.3 üåê Graph Intelligence & Ontologie

**Services:** `graph-api`, `graph-views`, `entity-resolution`, Ontology-Pakete

### Graph-API
- `/v1/cypher`, `/v1/nodes/{id}/neighbors`, `/v1/shortest-path` und `/v1/algorithms/*` (Centrality, PageRank, Louvain, Closeness, Betweenness, Connected Components).
- Export-Routen (`/export/json`, `/export/graphml`).
- Health-/Ready-Checks mit Neo4j-Ping.
- CLI-Unterst√ºtzung (`it graph.cypher`, `it graph.neighbors`, `it graph.shortest-path`).

### Graph-Views
- Materialisierte Views in Postgres (Aggregationen, Dossier-Feeds, KPI-√úbersichten).
- Geospatial-Endpunkte (`/v1/geo/upload/list/query/entities`).
- Path- und Ego-Network-APIs f√ºr Frontend-Explorer.
- Ontology-Layer (`services/graph-views/ontology`) definiert Entit√§tstypen, Relationen, Properties.

### Frontend `/graphx`
- Explorer mit interaktiver Netzvisualisierung (2D + 3D).
- Query-Editor (Cypher) mit Ergebnisansicht & CSV-Export.
- Analyse-Tab: Algorithmen ausl√∂sen, Resultate vergleichen, Heatmaps.
- Tools-Tab: GeoJSON-Verwaltung, Ontologie-Viewer, Graph-Export.
- Map-Overlay, Node-Details, Breadcrumbs, Bookmarking (local storage).

---

## 4.4 üìä Analytics, Views & Dashboards

- `/analytics` zeigt Nutzungs- und Durchsatzmetriken (Mock-Daten in Dev, pluggable Datasources in Prod).
- `graph-views` stellt REST-Endpoints f√ºr BI-Tools bereit (`/v1/views/<name>`), z.‚ÄØB. f√ºr Superset (Kapitel 15).
- KPI-CLI: `it analytics.overview --format table` (liefert Deltas und Summen aus Views).
- Integration mit Observability (Prometheus/Grafana) f√ºr Systemmetriken.

---

## 4.5 üóÇÔ∏è Dokumentenmanagement & Dossiers

**Komponenten:** Aleph-Anbindung, Dossier-Lite, Collaboration-Services

- Aleph-Ingest (√ºber NiFi) indexiert Dokumente in OpenSearch/Neo4j und synchronisiert Metadaten.
- `/documents` bietet eine strukturierte Liste mit Tags, Fingerprints, Status.
- Dossier-Lite (Kapitel 3.8) erzeugt Markdown/PDF-Reports und blendet Entities, Relations, Evidence ein.
- Exportformate: JSON (vollst√§ndig), Markdown (renderbar), PDF (Beta), optional GraphML f√ºr Visualisierung in Dritt-Tools.
- Collaboration: Notizzettel, Markierungen und ‚ÄûShared Notes‚Äú-Panels sind vorbereitet (Collab-Hub-Service) und werden √ºber Feature-Flags gesteuert.

---

## 4.6 ü§ñ Agenten & Workflows

**Komponenten:** Flowise-Connector, Agent Platform UI, n8n Playbooks

- Flowise-Connector stellt REST-Proxy bereit (`/api/agent/*`), inklusive Health-Checks.
- Agent Platform (`/agent`) bietet Chat, Task-Historie, Prompt-Templates, Tool-Auswahl (Search, Graph, Docs, Verification, Custom Tools).
- Multi-Agent-Mode (Feature Flag `NEXT_PUBLIC_FEATURE_MULTI_AGENT=1`): Kooperative Playbooks, Rollenverteilung.
- n8n-Playbooks (Kapitel 8) k√∂nnen durch Agenten ausgel√∂st werden (Webhooks).
- Logging & Audit: Requests laufen durch Gateway, Request-ID pro Agent-Step, Observability Hooks.

---

## 4.7 üõ°Ô∏è Verification & Media Intelligence

**Services:** `verification`, `media-forensics`, `forensics` (Images/Metadata), `rag-api`

- Claim-Extraktion (`/verification` UI, API `/v1/claims`) inklusive Clustering.
- Evidence Retrieval (BM25 + Dense Rerank) gegen interne/√∂ffentliche Quellen.
- Stance/RTE-Modelle validieren, ob Evidenz den Claim st√ºtzt.
- Source-Credibility: heuristische Scores, Reputation, Bot-Likelihood (konfigurierbar).
- Media-Forensics-Service: EXIF-Analyse, Perceptual Hashes, Reverse Image Search (optional, API-Key n√∂tig), Manipulationsindikatoren.
- Ergebnisse flie√üen in Dossiers & Reports ein.

---

## 4.8 üó∫Ô∏è Geospatial Layer

- GeoJSON-Uploads √ºber Graph-Views (`/v1/geo/upload`).
- Frontend-Map (Leaflet/MapLibre) in `/search` und `/graphx` mit Bounding-Box-Filtern.
- BBox-Query (`/v1/geo/query`) zur Laufzeit; `geo.entities` liefert Sample-Features.
- Kombination mit Graph-Algorithmen (z.‚ÄØB. Hotspot-Analysen).

---

## 4.9 üîê Gateway & OAuth2

- Node-basiertes Gateway (Express) mit `/api/{search|graph|views}` Proxies, Rate Limiting und Request-ID.
- JWT-Verifizierung gegen Auth-Service (`services/auth-service`) oder externen Provider.
- OTEL-Integration (`OTEL_SERVICE_NAME`, Exporter via `OTEL_EXPORTER_OTLP_*`).
- Policy Enforcement √ºber OPA (siehe Kapitel 9) und Federation-Proxy f√ºr verteilte Deployments.

---

Die folgenden Kapitel beschreiben erweiterte Funktionen (Security, Verification-Stacks, Plugins), Observability und CLI-Workflows im Detail.
