# 5. Erweiterte Funktionen

Dieses Kapitel beschreibt Sicherheits-, Automations- und Erweiterungsschichten, die über die Standard-Workflows hinausgehen.

---

## 5.1 Zugangskontrolle & Richtlinien

**Komponenten:** `auth-service`, Gateway, OPA/Policy-Pakete, Graph-Views

- **Auth-Service (FastAPI)**: JWT-/Refresh-Tokens, MFA-Option, Passwort-Policy, Audit-Logs. Verbindet sich mit Postgres (`it_auth`).
- **Gateway**: Validiert JWTs, erzwingt Rate Limits, injiziert `X-Request-Id`, setzt Security-Header (Helmet) und ermöglicht Request-Mirroring.
- **Open Policy Agent (OPA)**: Richtlinien (`services/policy/*.rego`) für Endpoint-Zugriffe, Integration via Sidecar (`docker-compose.opa.yml`).
- **Role Based Access Control**: Rollen `analyst`, `admin`, `ops`, `auditor` definieren UI- und API-Rechte (Frontend + Graph-Views).
- **Row-Level Security (RLS)**: Graph-Views/Postgres bietet RLS-Policies; Filter werden durch den Auth-Service bereitgestellt.
- **Secret Management**: `.env`/`.env.example` strukturieren alle Geheimnisse. Für produktive Deployments wird HashiCorp Vault oder Secret Stores empfohlen (siehe `docs/dev/security-hardening.md`).

---

## 5.2 Sichere Ausleitung & Privacy

**Komponenten:** `egress-gateway`, `federation-proxy`, `ops-controller`

- **Egress-Gateway**: Proxy mit optionaler Tor-/VPN-Unterstützung, Basic-Auth, Kill-Switch, DNS-Hardening. Läuft isoliert (`docker-compose.yml`, Port 8615).
- **Federation-Proxy**: Synchronisiert Richtlinien & Abfragen zwischen föderierten Instanzen (z. B. Multi-Tenant-Setups).
- **Ops-Controller & Ops-GUI**: Start/Stopp von Docker-Stacks aus der Oberfläche (`/settings?tab=ops`), inklusive Audit-Log. Aktivierung über `IT_OPS_ENABLE=1`.
- **Request-ID & Logging**: Alle Services nutzen `RequestIdMiddleware`; Logs liegen strukturierte JSONs (Loki-kompatibel) vor. Sensitive Daten lassen sich über Masking-Regeln (`observability/loki-config.yml`) filtern.
- **Telemetry Controls**: `IT_ENABLE_METRICS`, `IT_OTEL`, `OTEL_SDK_DISABLED` steuern Metriken/Tracing pro Service; Dev-Modus schaltet Telemetrie ab.

---

## 5.3 Verification-, RAG- & Forensic-Layer

**Komponenten:** `verification`, `rag-api`, `media-forensics`, `xai`

- **Verification-Service** orchestriert Claim Extraction, Evidence Retrieval, Stance Classification, Geo-/Temporal-Checks. Endpunkte liefern strukturierte JSON-Ergebnisse für Playbooks/Dossiers.
- **RAG-API** verbindet OpenSearch mit Graph/Neo4j für Retrieval-Augmented Generation; unterstützt Collections, Embedding-Indexe und liefert Markdown/PDF-Snippets.
- **Media-Forensics** analysiert Bilder (EXIF, Perceptual Hash, Manipulationsindikatoren) und kann optional Bing Visual Search einbinden (`REVERSE_SEARCH_ENABLED=1`).
- **Explainable AI (`xai`)** liefert Model Cards, Feature Importance und Erklärungen für ML-Outputs – integriert mit Verification & Graph-Algorithmen.

---

## 5.4 Plugin- & Tooling-Ökosystem

**Komponenten:** `plugin-runner`, `plugins/`, CLI-Plugin-Hooks, WaveTerm-/Workspace-Integrationen

- **Plugin-Runner** führt Tools (z. B. OSINT- oder Security-Skripte) isoliert aus – wahlweise direkt oder in Docker-Sandboxen. Ergebnisse werden serialisiert (`JSON`, Artefakt-Dateien) und mit Graph-/Search-Daten verknüpft.
- **Plugin-Registry** (`plugins/*.yaml`) beschreibt Metadaten, Parameter, benötigte Secrets. Health-Check & Versionierung pro Plugin sind integriert.
- **Frontend `/plugins`** zeigt installierte Module, Aktivierungsstatus (pro Benutzer/global) und Health.
- **CLI-Plug-ins**: Typer basiert; zusätzliche Befehle lassen sich via Entry Points einbinden.
- **WaveTerm/AppFlowy/AFFiNE**: Dokumentierte Integrationen (Kapitel 8.4/8.5) zur Einbettung von InfoTerminal-Funktionen in bestehende Workspaces.

---

## 5.5 Automatisierung & Multi-Agent-Systeme

**Komponenten:** Flowise-Connector, n8n, `agent-connector`, `ops-controller`

- **Flowise** liefert LLM-basierte Agenten. Tools: Search, Graph, Doc-Entities, Verification, n8n Webhooks, Custom Python.
- **Agent-Kontrollzentrum** (`/agent`) unterstützt Chat, Tool Selection, Run-Protokolle, Export von Prompts/Responses.
- **Multi-Agent (Feature Flag)** erlaubt Rollen wie *Research Analyst*, *Compliance Officer*, *Verification Lead* mit geteilten Task-Bords.
- **n8n-Playbooks** automatisieren Benachrichtigungen, Slack/Email-Alerts, tägliche Reports oder Eskalationsketten. Agenten können Playbooks triggern.
- **Ops-Automation**: `ops-controller` bietet REST-Endpunkte, um Compose-Stapel zu skalieren oder Tests zu starten – einsetzbar für Runbooks & GitOps.

---

## 5.6 Performance & Resilienz

- **Performance-Monitor** misst Antwortzeiten, Fehlerquoten und Lastspitzen; Ergebnisse landen in Prometheus/Grafana.
- **Chaos-Tests** (`tests/chaos/*.sh`) und Lasttests (`tests/performance/*.sh`) gehören zur v1.0-Abnahmesuite.
- **Caching**: Redis-basiertes `cache-manager` (optional) zur Beschleunigung von Reranking, Entity-Resolution und API-Responses.
- **Feature Flags** (über ENV oder Settings): aktivieren/deaktivieren Agents, Plugins, Workflows, Multi-Agent, Observability.

Diese Layer machen InfoTerminal in produktiven, sicherheitskritischen Umgebungen einsetzbar und bilden die Basis für weiterführende Kapitel (Integrationen, Monitoring, Security-Policies).
