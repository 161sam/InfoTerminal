# 11. Tipps & Best Practices

---

## 11.1 Allgemeine Nutzung

- **Klein starten**: Zuerst Kernservices (Search, Graph, Doc-Entities, Frontend) starten, danach Observability/Agents zuschalten.
- **CLI + UI kombinieren**: CLI für Automatisierung/Checks, UI für Exploration. `it status` regelmäßig nutzen.
- **Health-Checks**: `/healthz` für schnelle Prüfungen, `/readyz` für tiefergehende Dependencies. Frontend-Health-Kachel als Ampel.

---

## 11.2 Performance & Ressourcen

- **Dev vs. Prod**: Dev-Modus (`DEV_LOCAL=1`) für schnelles Iterieren; produktiv Container oder Kubernetes nutzen.
- **Reranking**: Nur aktivieren, wenn GPU/Leistung vorhanden; sonst `RERANK_ENABLED=0`.
- **Neo4j & OpenSearch**: RAM-Zuteilung in Compose-Dateien anpassen (Heap/Pagecache). Regelmäßige Indexpflege (`scripts/graph_refresh.sh`).
- **Doc-Entities**: Lange Texte chargenweise senden oder Summaries in NiFi vorberechnen.

---

## 11.3 Troubleshooting

- **Service unavailable** → `it logs --services <service>` prüfen, Health-Check (`/readyz`).
- **Port-Konflikte** → `scripts/patch_ports.sh` ausführen.
- **Frontend 404** → `apps/frontend/.env.local` prüfen; `NEXT_PUBLIC_*` müssen auf laufende Services zeigen.
- **n8n/Flowise** → CORS/Frame-Policy konfigurieren (`NEXT_PUBLIC_N8N_URL`, `NEXT_PUBLIC_FLOWISE_API`).
- **Doc-Entities DB-Migrationen** → `services/doc-entities/db.py` erstellt Tabellen automatisch; bei Fehlern Volume leeren (`docker volume rm infoterminal_doc_entities_db`).

---

## 11.4 Monitoring & Alerts

- **Observability on-demand**: Prometheus/Grafana nur bei Bedarf starten (`--profile observability`).
- **Dashboards versionieren**: Grafana-JSON exportieren und im Repo ablegen (`deploy/grafana/dashboards`).
- **Alerts**: Minimalset – Service Down, Error Rate > 5 %, High Latency.
- **Logs durchsuchen**: Loki Query mit `| json | line_format "{{.message}}"`.

---

## 11.5 Daten- & Workflow-Management

- **NiFi Flows**: Parameter Contexts nutzen, Fehlerrouten definieren, `DRY_RUN` Flags für Safe-Runs.
- **n8n Playbooks**: Secrets über Credential-Store, nicht direkt in Nodes.
- **Graph Maintenance**: Regelmäßig mit Cypher-Skripten oder NiFi-Flows verwaiste Knoten/Relationen aufräumen; Änderungen versionieren.
- **Versionierung**: Ontologie & Views als YAML/SQL im Repo pflegen (`services/graph-views/ontology`).

---

## 11.6 Sicherheit & Governance

- **Secrets** nie committen; `.env` nur lokal. In Prod: Secret Manager/Vault.
- **OPA Policies** regelmäßig testen (`opa test services/policy`).
- **RBAC pflegen**: Nur notwendigen Nutzern Admin-/Ops-Rechte geben. Regelmäßige Review.
- **Audit Logs**: Bewahren Sie Logs zentral auf (Loki + S3/Blob Storage als Long-Term Archive).

---

## 11.7 Zusammenarbeit

- **Shared Notes** & Dossiers für Teamarbeit verwenden.
- **Agenten** mit klaren Rollen profilieren (Research vs. Verification).
- **Annotations**: Entitäten & Relationen mit Kontext versehen (`Doc-Entities`), Dossiers referenzieren IDs statt Freitext.

Weitere Empfehlungen finden sich in `docs/dev/testing.md`, `docs/dev/perf.md` und den Runbooks.
