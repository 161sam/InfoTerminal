# 7. CLI-Handbuch

Die InfoTerminal CLI (`it`) bündelt Infrastruktursteuerung, API-Abfragen und Dev-Utilities. Installation siehe Kapitel 2.3.

---

## 7.1 Grundbefehle (Root)

| Befehl | Beschreibung |
| ------ | ------------ |
| `it start` | Docker-Compose-Stacks starten; akzeptiert `-f`, `--services`, `--profile`, `--detach` |
| `it stop` | Services stoppen |
| `it restart` | Services neu starten (mit Retry/Timeout) |
| `it rm` | Container entfernen (`-v` für Volumes, `--images local` löschen lokale Images) |
| `it status` | Compose-Status (table/text/json/yaml) |
| `it logs` | Logs streamen (`--services`, `--lines`, `--format jsonl`, `-F` folgen) |

Alle Befehle respektieren `--dry-run`, `--verbose`, `--quiet`. Die CLI zeigt beim Start einen Banner (abschaltbar mit `IT_NO_BANNER=1`).

---

## 7.2 Infra-Namespace

`it infra` bietet die gleichen Kommandos wie das Root, aber mit zusätzlichen Helfern:

```bash
it infra up --services search-api,graph-api --profile observability
it infra status --format json
it infra logs --services graph-api --lines 50 --follow
```

`it infra tui run` startet ein Textual-Terminal (optional, abhängig von `textual`).

---

## 7.3 Suche & Views

```bash
it search.query "ACME" --limit 15 --chart           # Tabelle + Score-Sparkline
it views.query "SELECT * FROM my_view" --limit 5   # ersetzen durch eigene View
```

Parameter:
- `--sort` (`relevance|date_desc|date_asc`)
- `--chart` visualisiert Scores/Verläufe im Terminal.

---

## 7.4 Graph-Kommandos

```bash
it graph.ping
it graph.cypher "MATCH (n) RETURN count(n) AS nodes"
it graph.neighbors 123 --depth 2 --limit 100 --visualize
it graph.shortest-path --source 1 --target 42 --max-length 8
```

Optionen wie `--param key=value` erlauben Cypher-Parameter. `--visualize` rendert eine ASCII-Adjazenzbaum-Ansicht.

---

## 7.5 Analytics & KPIs

```bash
it analytics.kpis --chart
```

Die Ausgabe kombiniert Tabellen (Rich) und optionale Minicharts. Daten stammen von `graph-views` (`/analytics/kpis`).

---

## 7.6 Frontend-Utilities

```bash
it fe dev      # Next.js Dev-Server (3411)
it fe build    # Produktions-Build
it fe test     # Vitest mit dot-Reporter
```

Diese Kommandos laufen im Repo-Kontext und nutzen `npm`/`pnpm`.

---

## 7.7 Konfiguration & Profile

```bash
it settings.show
```

Ausgabe: JSON aller CLI-Settings (Standardwerte aus `cli/it_cli/config.py`). Anpassungen via
- Environment (`IT_SEARCH_API`, `IT_GRAPH_API`, `IT_VIEWS_API`, …)
- JSON-Datei `~/.config/infoterminal/config.json`

Beispiel:
```json
{
  "search_api": "http://gateway:8080/api/search",
  "graph_api": "http://127.0.0.1:8402",
  "views_api": "http://127.0.0.1:8403"
}
```

---

## 7.8 Automatisierung

Die CLI eignet sich für Skripte und CI/CD:
- Healthcheck: `it status --format json | jq '.services[] | select(.status!="running")'`
- Backups triggern: `it infra exec postgres pg_dump ...` (via `--` Argumente).
- Playbooks: `it search.query ... | jq` als Input für n8n/Flowise.

---

## 7.9 Fehlerbehebung

- `typer.BadParameter` → Parameterformat prüfen (`key=value`).
- `HTTPError` → Service nicht erreichbar (Ports, `it status` checken).
- Keine Ausgabe? `--verbose` aktivieren (zeigt die generierten Compose-Kommandos).
- Banner jedes Mal? `IT_NO_BANNER=1` setzen.

Weitere Details in `cli/README.md` und `cli/it_cli/commands/*`.
