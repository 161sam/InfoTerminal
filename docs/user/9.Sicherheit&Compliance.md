# 9. Sicherheit & Compliance

InfoTerminal ist für den produktiven Einsatz in regulierten Umgebungen konzipiert. Dieses Kapitel fasst die wichtigsten Schutzmechanismen zusammen und verweist auf weiterführende Hardening-Guides.

---

## 9.1 Authentifizierung & Autorisierung

- **OAuth2/OIDC**: Integration über Auth-Service oder externen Provider (Keycloak, Auth0, Azure AD). Access-/Refresh-Tokens, MFA, Passwort-Policy.
- **Gateway-Absicherung**: JWT-Prüfung, Rate Limiting, IP Allowlists, Request-ID, Header Hardening.
- **RBAC**: Rollen `analyst`, `admin`, `ops`, `auditor`. Steuerung im Auth-Service und im Frontend (`/settings?tab=user-management`).
- **Policy Enforcement**: OPA-Regeln (`services/policy/*.rego`) definieren zulässige Aktionen (z. B. welche Rolle Graph-Schreibrechte besitzt).
- **Row-Level Security**: Graph-Views/Postgres implementiert RLS gemäß Policy (z. B. Sichtbarkeit pro Tenants/Case).

---

## 9.2 Audit, Logging & Nachvollziehbarkeit

- Alle Services loggen strukturierte JSONs mit `service`, `level`, `request_id`, `user`, `action`.
- Audit-Trail wird im Auth-Service und optional in Postgres (`audit`-Schema) persistiert.
- Loki/Grafana erlauben revisionssichere Aufbewahrung, Alertmanager kann Audit-Anomalien melden.
- Dossier- und Verification-Workflows speichern Evidence/Claim-IDs inkl. Timestamp und Bearbeiter.

---

## 9.3 Datenschutz & Datenflüsse

- **NiFi Provenance** zeichnet Transformationsschritte auf.
- **Doc-Entities** kann nach der Annotation aufbewahrte Rohtexte über Workflow-Policies löschen; empfohlen ist ein End-to-End-Prozess, der nur Entitäten/Relationen persistiert.
- **Geodaten** liegen in separatem Verzeichnis (`GEO_UPLOAD_DIR`), Standard: `/data/geo`.
- **PII-Filter**: Optionaler Scrubber (Regex/NER) in NiFi/n8n-Workflows.

---

## 9.4 Betriebs- und Netzwerksicherheit

- **TLS**: Empfohlen über Gateway/Ingress (siehe `docs/dev/tls.md`).
- **Secrets**: `.env` → `.env.production`; produktiv per Secret Store (Vault, K8s Secrets). Nie im Repo committen.
- **Backups**: Skripte in `docs/dev/backups.md` (OpenSearch Snapshot, Neo4j Dump, Postgres Dump).
- **Egress-Gateway**: Kontrolliert ausgehenden Traffic, Tor/VPN optional, Kill-Switch.
- **Ops-GUI**: Zugriff nur für `ops`/`admin`-Rollen; Docker-Socket erfordert Vertrauensumgebung.

---

## 9.5 Compliance-Roadmap

- DSGVO/GDPR: Datenhoheit bleibt lokal, Audit-Logs & Consent (opt-in) implementierbar.
- ISO 27001: Runbooks, Backup/Restore, RBAC, Logging, Monitoring decken Kernanforderungen ab.
- EU AI Act: Model Cards, Explainability (XAI-Service), Human-in-the-loop für Agenten & Verification.
- NIS2: Netzwerktrennung, Security-Monitoring, Incident Response (Runbooks) vorgesehen.

Weiterführende Dokumente: `SECURITY.md`, `docs/dev/SECURITY-BLUEPRINT.md`, `docs/dev/security-hardening.md`, `deploy/` (Terraform/Helm-Basis).
