apiVersion: batch/v1
kind: Job
metadata: { name: vault-bootstrap, namespace: external-secrets }
spec:
  backoffLimit: 0
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: vb
          image: hashicorp/vault:1.16
          command: ["/bin/sh","-lc"]
          args:
            - |
              set -e
              export VAULT_ADDR="$(cat /env/VAULT_ADDR)"
              export VAULT_TOKEN="$(cat /env/VAULT_TOKEN)"
              write() { vault kv put "kv/$1" $2; }
              # Example secrets
              write edge-auth/oauth2-proxy "client-id=dev-oidc" "client-secret=$(openssl rand -hex 24)" "cookie-secret=$(openssl rand -base64 32)"
              write analytics/superset "admin-password=$(openssl rand -hex 16)"
              write docs/aleph "ALEPH_SECRET_KEY=$(openssl rand -hex 32)"
              write pg/app "username=app" "password=$(openssl rand -hex 12)"
              echo "Bootstrap done."
          volumeMounts:
            - { name: env, mountPath: /env }
      volumes:
        - name: env
          secret: { secretName: vault-bootstrap }
